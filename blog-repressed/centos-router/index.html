<!doctype html><html lang=en-US><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="tripleo1"><meta name=description content="In this project I build home router based on a Centos 7. To my server connected two NICs: enp0s3 and enp0s8.
enp0s3 - will be WAN enp0s8 - will be LAN First of all we need to enable IP forwarding:
sysctl -w net.ipv4.ip_forward=1 Then tweak Firewalld rules:
firewall-cmd --set-default-zone=external firewall-cmd --permanent --zone=internal --add-interface=enp0s8 firewall-cmd --permanent --zone=internal --add-service=dhcp firewall-cmd --permanent --zone=internal --add-service=dns firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -o eth_ext -j MASQUERADE firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_int -o eth_ext -j ACCEPT firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_ext -o eth_int -m state --state RELATED,ESTABLISHED -j ACCEPT Install DHCP:"><meta property="og:title" content="Centos 7 home router"><meta property="og:description" content="In this project I build home router based on a Centos 7. To my server connected two NICs: enp0s3 and enp0s8.
enp0s3 - will be WAN enp0s8 - will be LAN First of all we need to enable IP forwarding:
sysctl -w net.ipv4.ip_forward=1 Then tweak Firewalld rules:
firewall-cmd --set-default-zone=external firewall-cmd --permanent --zone=internal --add-interface=enp0s8 firewall-cmd --permanent --zone=internal --add-service=dhcp firewall-cmd --permanent --zone=internal --add-service=dns firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -o eth_ext -j MASQUERADE firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_int -o eth_ext -j ACCEPT firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_ext -o eth_int -m state --state RELATED,ESTABLISHED -j ACCEPT Install DHCP:"><meta property="og:type" content="article"><meta property="og:url" content="https://tripleo1.github.io/blog-repressed/centos-router/"><meta property="article:section" content="blog-repressed"><meta property="article:published_time" content="2018-10-30T12:01:52+00:00"><meta property="article:modified_time" content="2018-10-30T12:01:52+00:00"><title>Centos 7 home router</title><link rel=canonical href=https://tripleo1.github.io/blog-repressed/centos-router/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500"><link rel=stylesheet href="https://tripleo1.github.io/css/reset.css?t=2023-08-16%2019%3a08%3a58.440930528%20%2b0000%20UTC%20m%3d%2b0.074314142"><link rel=stylesheet href="https://tripleo1.github.io/css/pygments.css?t=2023-08-16%2019%3a08%3a58.440930528%20%2b0000%20UTC%20m%3d%2b0.074314142"><link rel=stylesheet href="https://tripleo1.github.io/css/main.css?t=2023-08-16%2019%3a08%3a58.440930528%20%2b0000%20UTC%20m%3d%2b0.074314142"><link rel=stylesheet href="https://tripleo1.github.io/css/override.css?t=2023-08-16%2019%3a08%3a58.440930528%20%2b0000%20UTC%20m%3d%2b0.074314142"><link rel="shortcut icon" href=https://tripleo1.github.io/img/zen.ico></head><body lang=en><section class=header><div class=container><div class=content><a href=https://tripleo1.github.io/><img class=avatar src=https://tripleo1.github.io/img/zen.png alt=avatar srcset="https://tripleo1.github.io/img/zen.png 1x"></a>
<a href=https://tripleo1.github.io/><div class=name>tripleo1</div></a><nav><ul><li class=nav-blog><a href=https://tripleo1.github.io/blog/><span>Blog</span></a></li><li class=nav-about><a href=https://tripleo1.github.io/about/><span>About</span></a></li><li class=nav-code><a href=https://tripleo1.github.io/code/><span>Code</span></a></li><li class=nav-links><a href=https://tripleo1.github.io/links/><span>Links</span></a></li></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=//github.com/tripleo1 target=_blank rel=noopener><img class=icon src=https://tripleo1.github.io/img/github.svg alt=github></a>
<a href=//twitter.com/tripleo_sw target=_blank rel=noopener><img class=icon src=https://tripleo1.github.io/img/twitter.svg alt=twitter></a>
<a href=mailto:oluoluolu+blog@gmail.com><img class=icon src=https://tripleo1.github.io/img/email.svg alt=email></a></div></div></section><section class=main><div class=container><div class=content><div class=page-heading>Centos 7 home router</div><div class=markdown><p>In this project I build home router based on a Centos 7.
To my server connected two NICs: <code>enp0s3</code> and <code>enp0s8</code>.</p><ul><li><code>enp0s3</code> - will be WAN</li><li><code>enp0s8</code> - will be LAN</li></ul><p>First of all we need to enable IP forwarding:</p><pre tabindex=0><code>sysctl -w net.ipv4.ip_forward=1
</code></pre><p>Then tweak Firewalld rules:</p><pre tabindex=0><code>firewall-cmd --set-default-zone=external
firewall-cmd --permanent --zone=internal --add-interface=enp0s8
firewall-cmd --permanent --zone=internal --add-service=dhcp
firewall-cmd --permanent --zone=internal --add-service=dns
firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -o eth_ext -j MASQUERADE
firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_int -o eth_ext -j ACCEPT
firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -i eth_ext -o eth_int -m state --state RELATED,ESTABLISHED -j ACCEPT
</code></pre><p>Install DHCP:</p><pre tabindex=0><code>yum -y install dhcp
vi /etc/dhcp/dhcpd.conf
</code></pre><p>And edit dhcp configuration file:</p><pre tabindex=0><code># DHCP Server Configuration file.
#   see /usr/share/doc/dhcp*/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#

option domain-name &#34;tripleo1.io&#34;; 
option domain-name-servers 10.0.0.1;
default-lease-time 600; 
max-lease-time 7200; 
authoritative; 

subnet 10.0.0.0 netmask 255.255.255.0 { 
  range 10.0.0.100 10.0.0.254; 
  option broadcast-address 10.0.0.255; 
  option routers 10.0.0.1;
  option interface-mtu 1500; 
}

#host nas { 
#  option host-name &#34;nas.tripleo1.io&#34;; 
#  hardware ethernet f0:9f:c2:1f:c1:12; 
#  fixed-address 10.0.0.2; 
#}
</code></pre><p>Now enable and start your DHCP server:</p><pre tabindex=0><code>systemctl start dhcpd
systemctl enable dhcpd
</code></pre><p>Install DNS server:</p><pre tabindex=0><code>yum -y install bind-chroot bind-utils
</code></pre><p>Configure <code>/etc/named.conf</code>:</p><pre tabindex=0><code>//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
// See the BIND Administrator&#39;s Reference Manual (ARM) for details about the
// configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html

options {
	listen-on port 53 { 10.0.0.1; };
	listen-on-v6 port 53 { none; };
	directory 	&#34;/var/named&#34;;
	dump-file 	&#34;/var/named/data/cache_dump.db&#34;;
	statistics-file &#34;/var/named/data/named_stats.txt&#34;;
	memstatistics-file &#34;/var/named/data/named_mem_stats.txt&#34;;
	allow-query     { 10.0.0.0/24; };
	recursion yes;
	forwarders {1.1.1.1; 1.0.0.1; };
	dnssec-enable yes;
	dnssec-validation yes;

	/* Path to ISC DLV key */
	bindkeys-file &#34;/etc/named.iscdlv.key&#34;;

	managed-keys-directory &#34;/var/named/dynamic&#34;;

	pid-file &#34;/run/named/named.pid&#34;;
	session-keyfile &#34;/run/named/session.key&#34;;
};

logging {
        channel default_debug {
                file &#34;data/named.run&#34;;
                severity dynamic;
        };
};

zone &#34;.&#34; IN {
	type hint;
	file &#34;named.ca&#34;;
};

zone &#34;tripleo1.io&#34; IN {
	type master;
	file &#34;tripleo1.io.zone&#34;;
};

include &#34;/etc/named.rfc1912.zones&#34;;
include &#34;/etc/named.root.key&#34;;
</code></pre><p>Then create <code>/var/named/tripleo1.io.zone</code> file:</p><pre tabindex=0><code>$TTL 86400 
@ IN SOA gw.tripleo1.io. root.tripleo1.io. ( 
  2018103001	;Serial  
  3600		;Refresh 
  1800		;Retry 
  604800	;Expire 
  86400 )	;Minimum TTL

		IN NS		gw.tripleo1.io. 
		IN A		10.0.0.1
gw		IN A		10.0.0.1
nas		IN A		10.0.0.2
</code></pre><p>Now enable and start your DNS server:</p><pre tabindex=0><code>systemctl start named
systemctl enable named
</code></pre><p>Configured server will send DHCP broadcast in 10.0.0.0 subnet with caching DNS server.</p></div></div></div></section><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js></script>
<script type=text/javascript>hljs.initHighlightingOnLoad()</script></body></html>